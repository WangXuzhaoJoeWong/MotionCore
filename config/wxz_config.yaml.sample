# WXZ Robot YAML config sample
# Copy to config/wxz_config.yaml and edit as needed

comm:
  type: FastDDS   # FastDDS-only

# FastDDS runtime configuration (optional; ops-managed)
# If set, these values are used only when the corresponding environment variables
# are not already set for the current process.
#
# fastdds:
#   # XML environment file for peers / profiles / transports
#   # (relative paths are resolved against this YAML directory)
#   environment_file: resources/fastdds_peers_example.xml
#   log_filename: /tmp/fastdds.log
#   verbosity: warning

# 服务发现 / 注册中心配置（占位示例）
discovery:
  # 留空表示关闭 discovery（node_container 会跳过启动，适合离线/本机联调）
  endpoint: ""                                    # 服务注册/拉取节点列表的 HTTP 入口
  heartbeat_period_ms: 2000                        # 心跳上报周期（endpoint 非空才会生效）
  ttl_ms: 6000                                     # 心跳过期时间；接收端超时剔除（兼容键：heartbeat_ttl_ms）
  node_role: "workstation"                        # workstation / central / edge
  node_endpoints:
    - "fastdds:0"                                 # FastDDS 域或 profile 标识

# 通道治理：可选的白/黑名单。若 allow 非空，仅允许名单内；deny 优先级更高。
channel_filters:
  allow: []
  deny: []

threading:
  io_pool:
    threads: 2
  cpu_pool:
    threads: 4
  taskflow:
    threads: 2
  motion_planner:
    threads: 2

# 事件队列与调度
queue:
  max_size: 1024
  high_watermark: 900
  block_when_full: true
  drop_oldest: true

# observability (optional)
# - metrics.period_ms 目前主要用于进程内“定期采样/输出”的周期（例如 node_container 周期性输出 channel_registry 统计）。
# metrics:
#   period_ms: 5000

# fault recovery executor (optional)
# - Subscribe to fault/status and execute minimal recovery actions.
# - restart: request process exit with a specific code (let systemd/k8s restart it)
# - degrade: write a marker file as an observable “degraded triggered” latch
#
# fault_recovery:
#   enable: false
#   topic: fault/status
#   rules:
#     # Business degrade latch
#     - match: { fault: demo.degrade }
#       action: degrade
#       marker_file: /tmp/wxz_degraded
#
#     # Process restart request (exit code is for supervisors/CTest)
#     - match: { fault: demo.restart }
#       action: restart
#       exit_code: 77

dispatcher:
  max_retries: 2

param_server:
  enable: true
  set_topic: param.set
  ack_topic: param.ack

# 实时模式开关（启用后默认采用同步 publish、提高 transport priority）
realtime_mode: false

# 通道配置示例（FastDDS / shm）
channels:
  # 当前业务建议：按 Workstation 实际 topic 做最小集合。
  # 注意：domain 必须与现场 `WXZ_DOMAIN_ID` 保持一致。

  ws_arm_command:
    transport: fastdds
    domain: 0
    topic: /arm/command
    max_payload: 8192
    qos:
      reliability: reliable          # best_effort|reliable
      history: keep_last             # keep_last|keep_all
      depth: 16

  ws_arm_status:
    transport: fastdds
    domain: 0
    topic: /arm/status
    max_payload: 8192
    qos:
      reliability: best_effort
      history: keep_last
      depth: 32

  ws_system_alert:
    transport: fastdds
    domain: 0
    topic: /system/alert
    max_payload: 8192
    qos:
      reliability: reliable
      history: keep_last
      depth: 16

  ws_capability_status:
    transport: fastdds
    domain: 0
    topic: capability/status
    max_payload: 2048
    qos:
      reliability: best_effort
      history: keep_last
      depth: 8
