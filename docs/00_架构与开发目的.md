# MotionCore：架构与开发目的（新对话快速衔接用）

## 1) MotionCore 是什么

MotionCore 是“平台层核心库（SDK）”，目标是把分布式机器人系统里最容易写散/写崩的基础能力收敛成一套可复用、可观测、可稳定退出的框架与组件。

它面向两类用户：

- 业务应用开发（例如 Workstation）：用 ROS2-like 的方式写节点、发布/订阅、RPC 服务。
- 平台维护/排障：统一线程模型、统一指标口径、统一 teardown（退出/析构）策略。

## 2) 设计目标（为什么要做 MotionCore）

- 稳定性优先：进程退出/重启必须稳定（尤其是 DDS 相关对象的 teardown）。
- 统一并发模型：FastDDS listener 线程不跑业务；回调投递到 Executor/Strand，由主循环 tick/spin 驱动。
- 统一通信抽象：控制面（RPC）与事件流（Pub/Sub）都有一致的编码/解码、QoS、metrics、trace 传播能力。
- 业务侧易用：提供 Node/RpcService/EventDtoPublisher/EventDtoSubscription 等 facade，让业务代码聚焦业务而不是通信细节。

## 3) 核心概念（你在代码里会看到的）

- `workstation::Node`（或 framework Node）：
  - 创建 publisher/subscription（含 strand/回调投递）、管理生命周期。
- `RpcService`：
  - 面向控制面的 request/response，强调生命周期与线程模型可控。
- `EventDTO` 通道封装：
  - `EventDtoPublisher` / `EventDtoSubscription` 统一 DTO 编码/解码、payload pool、QoS、metrics。
- 线程模型约定：
  - listener 不跑业务；业务回调在 strand/executor 中串行化；主循环统一驱动。

## 4) 依赖与版本策略（为什么经常提 FastDDS pin）

- DDS（Fast-DDS/Fast-CDR）版本不一致会在 teardown 阶段触发崩溃或 UAF 类问题。
- 该工作空间推荐使用“workspace prefix pin”方式固定版本，避免误链接系统 `/usr/local` 的旧库。

## 5) 从哪里开始看（推荐阅读顺序）

- 规范与权威入口：MotionCore/docs/框架层约定与用法.md
- DTO 规范：MotionCore/docs/dto/README.md
- 迁移/破坏性变更：MotionCore/docs/迁移说明.md

## 6) 新开对话时的“快速交接模板”（复制到新对话第一条）

- 我在一个 workspace 里做机器人平台开发，包含 MotionCore（SDK）和 Workstation（应用）。
- 目标：<一句话目标>
- 当前问题：<一句话现象 + 1 行关键日志>
- 约束：DDS=FastDDS（workspace pinned），线程模型=listener 不跑业务，回调投递到 Executor/Strand。
- 相关文件：
  - MotionCore：<涉及的文件路径>
  - Workstation：<涉及的文件路径>
- 我希望你接下来做：<例如：给排障步骤/改代码/跑构建>
